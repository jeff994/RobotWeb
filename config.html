<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
	body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
	</style>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=IRLYepkYHoZV6EYCBPC5sLlWkqu1RgL7"></script>
	<script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
	<script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
	<style type="text/css">
		*,html,body,div,ul,li,a{margin:0;padding:0;list-style:none;}
		center.fontCenter{text-align:center;font-size: 20px;color:#3d1e95;margin:10px auto;}
		.navi{width:100%;margin:10px auto 0;overflow: hidden;background-color:#5721a9;}
		.navi li{width:20%;float:left;}
		.navi li a{width:100%;height:28px;font-size:12px;text-align:center;color:#ccc;padding-top:10px; text-decoration: none; display:block;}
		.navi li a:hover{color:#fff;}
	</style>
	<title>机器人配置</title>

	<script type="text/javascript">

		// Connecting to ROS
	  // -----------------

	  var ros = new ROSLIB.Ros({
	    url : 'ws://localhost:9090'
	  });

	  ros.on('connection', function() {
	    console.log('Connected to websocket server.');
	  });

	  ros.on('error', function(error) {
	    console.log('Error connecting to websocket server: ', error);
	  });

	  ros.on('close', function() {
	    console.log('Connection to websocket server closed.');
	  });


	  var listener = new ROSLIB.Topic({
	    ros : ros,
	    name : '/gps',
	    messageType : 'std_msgs/String'
	  });

	</script>

</head>
<body>

<div class="navi">
	<ul>
			<li><a href="index.html" target="_blank">主页</a></li>
			<li><a href="map.html" target="_blank">地图</a></li>
			<li><a href="interaction.html" target="_blank">交互</a></li>
			<li><a href="control.html" target="_blank">控制</a></li>
			<li><a href="config.html" target="_blank">配置</a></li>
		</ul>
	</div>
	<center class="fontCenter">机器人配置</center>
	
  <div id="allmap"></div>https://www.yahoo.com/
</body>
<script type="text/javascript">

	var removeMarker = function(e,ee,marker){
		window.open("http://www.yahoo.com", 'newwindow','height=100,width=400,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no');
	}
		// 百度地图API功能
	var map = new BMap.Map("allmap");
    map.addControl(new BMap.ScaleControl());  
    map.addControl(new BMap.NavigationControl());  
	lat = 31.205718
	lon = 121.628857
	var markerMenu=new BMap.ContextMenu();
	var point = new BMap.Point(lon, lat);
	map.centerAndZoom(point, 19);
	var marker = new BMap.Marker(point);  // 创建标注
	map.addOverlay(marker);               // 将标注添加到地图中
	markerMenu.addItem(new BMap.MenuItem('打开视频',removeMarker.bind(marker)));
	marker.addContextMenu(markerMenu);

	listener.subscribe(function(message) {
	    console.log('Received message on ' + listener.name + ': ' + message.data);
	    var [lonstr, latstr, bearingstr] = message.data.split(' ');
	    lon_new = parseFloat(lonstr);
	    lat_new = parseFloat(latstr)
	    if(lat_new == lat && lon_new == lon)
	    	return;

	    bearing = parseFloat(bearingstr)
	    map.removeOverlay(marker);
	    console.log('Received message on ' + lon + ': ' + lat);
		var point = new BMap.Point(lon, lat);
		marker = new BMap.Marker(point);  // 创建标注
		map.addOverlay(marker);               // 将标注添加到地图中
		//marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
		lat = lat_new
		lon = lon_new
	 });
</script>
</html>
